---
interface Post {
  title: string;
  slug: string;
  excerpt: string;
  publishedAt: string;
  tags: string[];
}

interface Props {
  posts: Post[];
  currentLang?: string;
}

const { posts, currentLang = 'en' } = Astro.props;
const base = import.meta.env.BASE_URL;

// Serialize data for the inline script
const searchDataScript = `window.__SEARCH_DATA__ = ${JSON.stringify({ posts, base, currentLang })};`;
---

<div class="search-container">
  <div class="mb-8">
    <input
      type="text"
      id="search-input"
      placeholder="Search for posts..."
      class="w-full px-4 py-3 text-lg border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100"
      aria-label="Search posts"
    />
  </div>

  <div id="search-results" class="space-y-6">
    <p class="text-gray-600 dark:text-gray-400 text-center py-8">
      Start typing to search...
    </p>
  </div>

  <div id="no-results" class="hidden text-center py-12">
    <p class="text-gray-600 dark:text-gray-400 text-lg">
      No posts found matching your search.
    </p>
  </div>
</div>

<script is:inline set:html={searchDataScript} />

<script type="module">
  import { initSearchWithData } from '/src/scripts/search-client.js';

  const { posts, base, currentLang } = window.__SEARCH_DATA__;
  initSearchWithData(posts, base, currentLang);
</script>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
