---
import type { PortableTextBlock, PortableTextTextBlock } from '@sanity/types'

interface Props {
  blocks: PortableTextBlock[]
}

const { blocks } = Astro.props

function renderBlock(block: PortableTextBlock): string {
  const children = (block as PortableTextTextBlock).children
  if (!children || children.length === 0) return ''

  const text = children.map((child) => child.text).join('')

  switch (block.style) {
    case 'h1':
      return `<h1 class="text-3xl font-bold mb-4 mt-6">${text}</h1>`
    case 'h2':
      return `<h2 class="text-2xl font-bold mb-3 mt-5">${text}</h2>`
    case 'h3':
      return `<h3 class="text-xl font-bold mb-2 mt-4">${text}</h3>`
    case 'h4':
      return `<h4 class="text-lg font-bold mb-2 mt-4">${text}</h4>`
    case 'blockquote':
      return `<blockquote class="border-l-4 border-gray-300 dark:border-gray-600 pl-4 italic my-4 text-gray-700 dark:text-gray-300">${text}</blockquote>`
    case 'normal':
    default:
      if (block.listItem) {
        if (block.listItem === 'bullet') {
          return `<li class="ml-4">${text}</li>`
        } else if (block.listItem === 'number') {
          return `<li class="ml-4 list-decimal">${text}</li>`
        }
      }
      return `<p class="mb-4 leading-relaxed">${text}</p>`
  }
}
---

<div class="prose prose-lg dark:prose-invert max-w-none">
  {
    blocks.map((block) => (
      <div set:html={renderBlock(block)} />
    ))
  }
</div>
