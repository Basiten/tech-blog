---
import BaseLayout from '../layouts/BaseLayout.astro';
import Search from '../components/Search.astro';
import { getBlogPosts } from '../lib/sanity';

const allPosts = await getBlogPosts();
const postsForSearch = allPosts.map(post => ({
  title: post.title,
  slug: post.slug.current,
  excerpt: post.excerpt || '',
  publishedAt: post.publishedAt,
  tags: post.tags?.map(tag => tag.name) || []
}));

const pageTitle = 'Search';
const pageDescription = 'Search through all blog posts';
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <div class="max-w-3xl mx-auto">
    <header class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4">
        Search Posts
      </h1>
      <p class="text-lg text-gray-700 dark:text-gray-300">
        Find articles by title, content, or tags
      </p>
    </header>

    {allPosts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-gray-600 dark:text-gray-400 text-lg">
          No posts available to search. Check back soon!
        </p>
      </div>
    ) : (
      <Search posts={postsForSearch} />
    )}
  </div>
</BaseLayout>
