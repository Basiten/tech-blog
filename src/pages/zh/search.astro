---
import BaseLayout from '../../layouts/BaseLayout.astro';
import BlogSearch from '../../components/Search.astro';
import { getBlogPosts } from '../../lib/sanity';
import { useTranslations, getLanguageFromPath, getBasePath, type SupportedLanguage } from '../../i18n';

const allPosts = await getBlogPosts();
const postsForSearch = allPosts.map(post => ({
  title: post.title,
  slug: post.slug.current,
  excerpt: post.excerpt || '',
  publishedAt: post.publishedAt,
  tags: post.tags?.map(tag => tag.name) || []
}));

const currentLang: SupportedLanguage = 'zh';
const currentPath = Astro.url.pathname;
const base = getBasePath();
const { t } = useTranslations(currentLang);

const pageTitle = t('search.title');
const pageDescription = t('search.description');
---

<BaseLayout title={pageTitle} description={pageDescription} currentPath={currentPath} currentLang={currentLang}>
  <div class="max-w-3xl mx-auto">
    <header class="mb-8">
      <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4">
        {t('search.heading')}
      </h1>
      <p class="text-lg text-gray-700 dark:text-gray-300">
        {t('search.subtitle')}
      </p>
    </header>

    {allPosts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-gray-600 dark:text-gray-400 text-lg">
          {t('search.noPosts')}
        </p>
      </div>
    ) : (
      <BlogSearch posts={postsForSearch} currentLang={currentLang} />
    )}
  </div>
</BaseLayout>