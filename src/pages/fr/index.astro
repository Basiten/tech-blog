---
import BaseLayout from '../../layouts/BaseLayout.astro'
import BlogCard from '../../components/BlogCard.astro'
import { client } from '../../lib/sanity'
import { useTranslations, getLanguageFromPath, getBasePath, type SupportedLanguage } from '../../i18n'

const posts = await client.fetch(`
  *[_type == 'blogPost'] | order(publishedAt desc) {
    title, slug, excerpt, publishedAt, tags[]->{name}
  }
`)

const currentLang: SupportedLanguage = 'fr';
const currentPath = Astro.url.pathname;
const base = getBasePath();
const { t } = useTranslations(currentLang);

const pageTitle = t('home.title')
const pageDescription = t('home.description')
---

<BaseLayout title={pageTitle} description={pageDescription} currentPath={currentPath} currentLang={currentLang}>
  <div class="space-y-8">
    <header>
      <h1 class="text-4xl font-bold text-gray-900 dark:text-gray-100 mb-4">
        {t('home.welcome')}
      </h1>
      <p class="text-lg text-gray-700 dark:text-gray-300">
        {t('home.subtitle')}
      </p>
    </header>

    {posts.length === 0 ? (
      <div class="text-center py-12">
        <p class="text-gray-600 dark:text-gray-400 text-lg">
          {t('home.noPosts')}
        </p>
      </div>
    ) : (
      <div class="grid gap-6 md:grid-cols-1">
        {posts.map((post: any) => (
          <BlogCard
            title={post.title}
            slug={post.slug.current}
            excerpt={post.excerpt || ''}
            publishedAt={post.publishedAt}
            tags={post.tags?.map((tag: any) => tag.name) || []}
            currentLang={currentLang}
          />
        ))}
      </div>
    )}
  </div>
</BaseLayout>
